// ----------------------------------------------------------------
            // モックデータ生成 + リアルデータのマージ
            // ----------------------------------------------------------------
            const generateAllCampusesData = (targetCampuses, realEnrollmentList, realStatusList, targetYear) => {
                const dataMap = {};

                // ■ マッピングテーブル作成 (スプシ上の名前 -> 校舎ID)
                const sheetNameToIdMap = {};
                targetCampuses.forEach(c => {
                    // sheetNameが設定されていればそれを、なければnameを使う
                    const key = c.sheetName || c.name;
                    sheetNameToIdMap[key] = c.id;
                });

                // ■ ヘルパー: 指定年度より「前」の累計数をカウント (期首在庫計算用)
                const countTotalBefore = (list, year, typeFilter = null) => {
                    const counts = {}; // { campusId: count }
                    if (!list) return counts;

                    list.forEach(item => {
                        const dateObj = new Date(item.date);
                        if (isNaN(dateObj)) return;
                        
                        // 指定年度より前のデータのみ対象
                        if (getFiscalYear(dateObj) >= year) return;

                        // 種別チェック
                        if (typeFilter) {
                            if (!item.type || !item.type.includes(typeFilter)) return;
                        }

                        // 校舎ID特定
                        const rawSheetName = item.campus;
                        const campusId = sheetNameToIdMap[rawSheetName];
                        if (!campusId) return;

                        counts[campusId] = (counts[campusId] || 0) + 1;
                    });
                    return counts;
                };

                // ■ ヘルパー: 指定年度「内」の月次集計
                const countEvents = (list, typeFilter = null) => {
                    // counts[校舎ID][月Idx] = { total: 0, days: { 1: 0, ... } }
                    const counts = {};
                    if (!list) return counts;

                    list.forEach(item => {
                        const dateObj = new Date(item.date);
                        if (isNaN(dateObj)) return;
                        
                        // 年度チェック
                        if (getFiscalYear(dateObj) !== targetYear) return;

                        // 種別チェック (status_changes用)
                        if (typeFilter) {
                            if (!item.type || !item.type.includes(typeFilter)) return;
                        }

                        // 校舎ID特定
                        const rawSheetName = item.campus;
                        const campusId = sheetNameToIdMap[rawSheetName];
                        if (!campusId) return;

                        const monthIdx = (dateObj.getMonth() + 9) % 12; 
                        const day = dateObj.getDate();

                        if (!counts[campusId]) counts[campusId] = {};
                        if (!counts[campusId][monthIdx]) counts[campusId][monthIdx] = { total: 0, days: {} };
                        
                        counts[campusId][monthIdx].total++;
                        if (!counts[campusId][monthIdx].days[day]) counts[campusId][monthIdx].days[day] = 0;
                        counts[campusId][monthIdx].days[day]++;
                    });
                    return counts;
                };

                // 1. 期首時点（前年度末まで）の累計を集計
                const prevEnrollments = countTotalBefore(realEnrollmentList, targetYear);
                const prevWithdrawals = countTotalBefore(realStatusList, targetYear, "退会");
                const prevTransfers = countTotalBefore(realStatusList, targetYear, "転校"); // 転出
                const prevGraduates = countTotalBefore(realStatusList, targetYear, "卒業");
                // ※転入、復会、休会は初期数計算において、
                //  - 転入: +
                //  - 復会: (休会中も在籍扱いなら影響なし)
                //  - 休会: (在籍扱いなら影響なし)
                //  ここではユーザー定義に従い「入会+転入 - 退会-転出」を基本とするが、
                //  「卒業」も在籍から外れるためマイナスする

                // 2. 当該年度の各種データを集計
                const enrollmentCounts = countEvents(realEnrollmentList);
                const withdrawalCounts = countEvents(realStatusList, "退会");
                const recessCounts = countEvents(realStatusList, "休会");
                const returnCounts = countEvents(realStatusList, "復会");
                const transferCounts = countEvents(realStatusList, "転校"); // 転出
                const graduateCounts = countEvents(realStatusList, "卒業");

                const hasRealData = realEnrollmentList.length > 0 || realStatusList.length > 0;

                targetCampuses.forEach(campusObj => {
                    const campusId = campusObj.id;
                    
                    // ★ 初期生徒数（期首人数）の計算
                    let currentStudents = 0;
                    
                    if (hasRealData) {
                        const pEnroll = prevEnrollments[campusId] || 0;
                        const pWithdraw = prevWithdrawals[campusId] || 0;
                        const pTransfer = prevTransfers[campusId] || 0;
                        const pGraduate = prevGraduates[campusId] || 0;
                        // 前期末在籍数 = 過去の入会 - 過去の退会 - 過去の転出 - 過去の卒業
                        currentStudents = pEnroll - pWithdraw - pTransfer - pGraduate;
                    } else {
                        // モックモード: 年度に応じた成長シミュレーション
                        const seed = campusId.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                        const scale = (0.5 + (seed % 10) / 10);
                        // 基準年(2023)からの経過年数でベースを増やす
                        const yearDiff = targetYear - 2023;
                        const base = Math.floor(50 * scale);
                        // 毎年少しずつ増える想定 (マイナスにはしない)
                        currentStudents = Math.max(0, Math.floor(base + (base * 0.1 * yearDiff)));
                    }

                    // 月ごとの乱数調整用スケール
                    const seed = campusId.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                    const scale = (0.5 + (seed % 10) / 10); 

                    dataMap[campusId] = MONTHS_LIST.map((month, idx) => {
                        const seasonality = [0.8, 0.9, 1.0, 1.2, 1.3, 1.0, 1.0, 0.9, 1.1, 0.8, 0.9, 1.5][idx];
                        
                        const monthlyBudget = Math.floor(2000000 * scale * seasonality);
                        const monthlyActual = Math.floor(monthlyBudget * (0.85 + Math.random() * 0.3));
                        const monthlyFlyers = Math.floor(1000 * scale * seasonality);
                        
                        // ■ 各種実績値の取得
                        const getCount = (countsObj) => (countsObj[campusId] && countsObj[campusId][idx]) ? countsObj[campusId][idx].total : 0;
                        const getDays = (countsObj) => (countsObj[campusId] && countsObj[campusId][idx]) ? countsObj[campusId][idx].days : {};

                        let val = {
                            enroll: 0, withdraw: 0, recess: 0, return: 0, transfer: 0, graduate: 0, transferIn: 0
                        };

                        if (hasRealData) {
                            val.enroll = getCount(enrollmentCounts);
                            val.withdraw = getCount(withdrawalCounts);
                            val.recess = getCount(recessCounts);
                            val.return = getCount(returnCounts);
                            val.transfer = getCount(transferCounts); // 転出
                            val.graduate = getCount(graduateCounts);
                            // 転入データがあればここで取得 (現状はソースがないため0)
                        } else {
                            // モックモード: 全て0 (ユーザー要望によりデフォルト0)
                            val.enroll = 0;
                            val.withdraw = 0;
                            val.graduate = 0;
                        }

                        // ■ 日次データ生成
                        const daily = Array.from({ length: 30 }, (_, dIdx) => {
                            const dayNum = dIdx + 1;
                            const getDayCount = (daysObj) => (daysObj[dayNum] || 0);
                            
                            // リアルデータがあれば日次マップから取得
                            const dEnroll = hasRealData ? getDayCount(getDays(enrollmentCounts)) : 0;
                            const dWithdraw = hasRealData ? getDayCount(getDays(withdrawalCounts)) : 0;
                            const dRecess = hasRealData ? getDayCount(getDays(recessCounts)) : 0;
                            const dReturn = hasRealData ? getDayCount(getDays(returnCounts)) : 0;
                            const dTransfer = hasRealData ? getDayCount(getDays(transferCounts)) : 0;
                            const dGraduate = hasRealData ? getDayCount(getDays(graduateCounts)) : 0;

                            return {
                                name: `${dayNum}日`,
                                budgetRevenue: 0,
                                actualRevenue: 0,
                                newEnrollments: dEnroll,
                                withdrawals: dWithdraw,
                                recesses: dRecess,
                                returns: dReturn,
                                transfers: dTransfer,
                                graduates: dGraduate,
                                flyers: 0,
                                totalStudents: currentStudents // 日次は簡易的に月初の値を維持表示
                            };
                        });

                        // ■ 週次データ生成
                        const weekly = Array.from({ length: 4 }, (_, wIdx) => {
                            const startDay = wIdx * 7 + 1;
                            const endDay = wIdx === 3 ? 31 : (wIdx + 1) * 7;
                            
                            let wVal = { enroll: 0, withdraw: 0, recess: 0, return: 0, transfer: 0, graduate: 0 };
                            
                            for (let i = startDay - 1; i < endDay && i < 30; i++) {
                                wVal.enroll += daily[i].newEnrollments;
                                wVal.withdraw += daily[i].withdrawals;
                                wVal.recess += daily[i].recesses;
                                wVal.return += daily[i].returns;
                                wVal.transfer += daily[i].transfers;
                                wVal.graduate += daily[i].graduates;
                            }

                             return {
                                name: `第${wIdx + 1}週`,
                                budgetRevenue: 0,
                                actualRevenue: 0,
                                newEnrollments: wVal.enroll,
                                withdrawals: wVal.withdraw,
                                recesses: wVal.recess,
                                returns: wVal.return,
                                transfers: wVal.transfer,
                                graduates: wVal.graduate,
                                flyers: 0,
                                enrollmentRate: "0.0",
                                totalStudents: currentStudents 
                            };
                        });

                        // 在籍数更新ロジック
                        // 前月末在籍数 ＋ 入会数 ＋ 転入 － 退会数 － 転出 - 卒業
                        const netChange = val.enroll + val.transferIn - val.withdraw - val.transfer - val.graduate;
                        currentStudents += netChange;

                        return {
                            name: month,
                            budgetRevenue: monthlyBudget,
                            actualRevenue: monthlyActual,
                            newEnrollments: val.enroll,
                            withdrawals: val.withdraw,
                            recesses: val.recess,
                            returns: val.return,
                            transfers: val.transfer,
                            graduates: val.graduate,
                            totalStudents: currentStudents,
                            flyers: monthlyFlyers,
                            touchAndTry: Math.floor(monthlyFlyers * 0.05),
                            trialLessons: 0, 
                            enrollmentRate: "0.0",
                            daily, weekly
                        };
                    });
                });
